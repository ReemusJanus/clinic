{% extends "management/navbar.html" %}
{% load static %}

{% block content %}

<section id="registration">
    <div class="container">
      <h1 class="text-center mt-5">New Patient Registration</h1><br>
      <hr><br>
      <div class="card">
        <div class="card-body text_size py-4">
          <form class="form_center text-justify" method="POST">
            {% csrf_token %}
            <div class="form-group row d-flex justify-content-center">
               
              <div class="col-lg-4 text-lg-center text-md-left">
                <label for="inputid">Patient Id&nbsp;&nbsp;:</label>
              </div>
              <div class="col-lg-5">
                <input type="text" class="form-control mb-4" name="patient_id" value="{{patient_id}}" id="inputid" readonly required>
              </div>
            </div>
            <div class="form-group row d-flex justify-content-center">
             
              <div class="col-lg-4 text-lg-center text-md-left">
                <label for="inputname" class="text-center">Patient Name&nbsp;&nbsp;:</label>
              </div>
              <div class="col-lg-5">
                
                <input type="text" class="form-control mb-4" name="patient_name" value="{{form.patient_name.value|default_if_none:''}}" id="inputname" required>
                <span class="text-danger">{{form.patient_name.errors}} </span>
            </div>
            </div>
            <div class="form-group row d-flex justify-content-center">
             
              <div class="col-lg-4 text-md-left text-lg-center">
                <label for="inputname3" class="text-center">Father's Name&nbsp;&nbsp;:</label>
                
              </div>
              <div class="col-lg-5">
                
                <input type="text" name="fathers_name" value="{{form.fathers_name.value|default_if_none:''}}" class="form-control mb-4" id="inputname3" required>
                <span class="text-danger">{{form.fathers_name.errors}} </span>
              </div>
            </div>


            <div class="form-group row d-flex justify-content-center">
             
              <div class="col-lg-4 text-md-left text-lg-center">
                <label for="birth_date_input" class="text-center">Birth Date  : </label>
                
              </div>
              <div class="col-lg-5">
                <input type="date" class="form-control" value="{{form.date_of_birth.value}}" name="date_of_birth" id="birth_date">
                <span class="text-danger">{{form.date_of_birth.errors}} </span>
              </div>
            </div>

            <div class="form-group row d-flex justify-content-center">
             
              <div class="col-lg-4 text-md-left text-lg-center">
                <label for="exact_age" class="text-center">Age  :</label>
                
              </div>
              <div class="col-lg-5">
                <input type="text" class="form-control"  name="age" id="exact_age">
                <span class="text-danger">{{form.age.errors}} </span>
              </div>
            </div>


      
        
        
        
        {% comment %} <p><em>* The year here is 365 days and the month here is 30 days, that means your birthday may not mean you will
                be 0 days old.</br>
                **Don't worry I will not share your input.</em></p> {% endcomment %}
        {% comment %} </p> {% endcomment %}        
              
            
             
              
            <div class="form-group row d-flex justify-content-center ">
              
              <div class="col-lg-4 text-md-left text-lg-center mt-2 mb-2">

                <label for="gender" class="text-center">Gender&nbsp;&nbsp;:</label>

              </div>
              <div class="col-lg-5 mt-2 mb-2">

                
                {% if form.gender.value == 'Male' %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio1"
                    value="Male" checked required>
                  <label class="form-check-label text-dark" for="inlineRadio1" >Male</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio2"
                    value="Female" required>
                  <label class="form-check-label text-dark" for="inlineRadio2">Female</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio3"
                    value="Others" required>
                  <label class="form-check-label text-dark" for="inlineRadio3">Others</label>
                </div>
              </div>
                {% elif form.gender.value == 'Female' %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio1"
                    value="Male" required>
                  <label class="form-check-label text-dark" for="inlineRadio1">Male</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio2"
                    value="Female" checked required> 
                  <label class="form-check-label text-dark" for="inlineRadio2" >Female</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio3"
                    value="Others" required>
                  <label class="form-check-label text-dark" for="inlineRadio3">Others</label>
                </div>

                {% else %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio1"
                    value="Male" required>
                  <label class="form-check-label text-dark" for="inlineRadio1">Male</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio2"
                    value="Female" required>
                  <label class="form-check-label text-dark" for="inlineRadio2" >Female</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="inlineRadio3"
                    value="Others" checked required>
                  <label class="form-check-label text-dark" for="inlineRadio3" >Others</label>
                </div>
                 {% endif %}
              </div>
            </div>

            <div class="form-group row d-flex justify-content-center">
              
              <div class="col-lg-4 text-md-left text-lg-center">
                <label for="inputname4" class="text-center">Blood&nbsp;Group&nbsp;:</label>
              </div>
              <div class="col-lg-5">
               
                <input type="text" name="blood_group"  value="{{form.blood_group.value |default_if_none:''}}" class="form-control mb-4" id="inputname4" >
                <span class="text-danger">{{form.blood_group.errors}} </span>
            </div>
            </div> 

            <div class="form-group row d-flex justify-content-center">
              
              <div class="col-lg-4 text-md-left text-lg-center">


                <label for="validationTextarea">Address&nbsp;&nbsp;:</label>

              </div>
              <div class="col-lg-5">
                <span class="text-danger">{{form.address.errors}} </span>
                <textarea class="form-control mb-4" name="address" value="" rows="4" cols="50" id="validationTextarea" placeholder="" required>{{form.address.value|default_if_none:''}}</textarea>

              </div>

            </div>
            <div class="form-group row d-flex justify-content-center">
              
              <div class="col-lg-4 text-md-left text-lg-center mb-4">
                <label for="number" class="col-form-label">Phone&nbsp;Number&nbsp;&nbsp;:</label>
              </div>
              <div class="col-lg-5">                
                <input onkeypress="return isNumberKey(event)" type="tel" name="phone_number" value="{{form.phone_number.value|default_if_none:''}}" class="form-control" id="number" required minlength="10" maxlength="10">
                <br><span class="text-danger">{{form.phone_number.errors}} </span>
            </div>
            </div>
        </div>
        <div class="col-lg-12 d-flex justify-content-center mb-5">
          <button type="submit" class="btn btn-outline-success">Save</button>
          <button type="reset" class="btn btn-outline-danger ml-5">Cancel</button>
        </div>
        </form>
      </div>


       

  </section>



{% if messages %}  
    <ul>   
        {% for message in messages %}  
            <li>{{ message }}</li>  
            {% endfor %}  
    </ul>   
{% endif %}
  {% endblock %} 

  {% block script %}
        $(document).ready(function () {
          

          var mdate = $("#birth_date").val().toString();
          var yearThen = parseInt(mdate.substring(0, 4), 10);
          var monthThen = parseInt(mdate.substring(5, 7), 10);
          var dayThen = parseInt(mdate.substring(8, 10), 10);

          var today = new Date();
          var birthday = new Date(yearThen, monthThen - 1, dayThen);

          var differenceInMilisecond = today.valueOf() - birthday.valueOf();

          var year_age = Math.floor(differenceInMilisecond / 31536000000);
          var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

          if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
              alert("Happy B'day!!!");
          }

          var month_age = Math.floor(day_age / 30);

          day_age = day_age % 30;

          if (isNaN(year_age) || isNaN(month_age) || isNaN(day_age)) {
              $("#exact_age").val("Invalid birthday - Please try again!");
          }
          else {
              if (year_age <= 0 && month_age < 0 && day_age < 0) {
                  $("#exact_age").val("Invalid birthday - Please try again!");
              }

              else if (year_age < 1) {
                  if (month_age <= 1) {
                      $('#exact_age').val(+ day_age + " days")
                  }
                  else {
                      $('#exact_age').val(+ month_age + " months")

                  }
              }
              else if (year_age >= 1) {
                  $("#exact_age").val(+ year_age + " years");
              }

          }




            $("#birth_date").change(function () {
              
                var mdate = $("#birth_date").val().toString();
                var yearThen = parseInt(mdate.substring(0, 4), 10);
                var monthThen = parseInt(mdate.substring(5, 7), 10);
                var dayThen = parseInt(mdate.substring(8, 10), 10);

                var today = new Date();
                var birthday = new Date(yearThen, monthThen - 1, dayThen);

                var differenceInMilisecond = today.valueOf() - birthday.valueOf();

                var year_age = Math.floor(differenceInMilisecond / 31536000000);
                var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

                if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
                    alert("Happy B'day!!!");
                }

                var month_age = Math.floor(day_age / 30);

                day_age = day_age % 30;

                if (isNaN(year_age) || isNaN(month_age) || isNaN(day_age)) {
                    $("#exact_age").val("Invalid birthday - Please try again!");
                }
                else {
                    if (year_age <= 0 && month_age < 0 && day_age < 0) {
                        $("#exact_age").val("Invalid birthday - Please try again!");
                    }

                    else if (year_age < 1) {
                        if (month_age <= 1) {
                            $('#exact_age').val(+ day_age + " days")
                        }
                        else {
                            $('#exact_age').val(+ month_age + " months")

                        }
                    }
                    else if (year_age >= 1) {
                        $("#exact_age").val(+ year_age + " years");
                    }

                }



            });
        });
      {% endblock script %}
